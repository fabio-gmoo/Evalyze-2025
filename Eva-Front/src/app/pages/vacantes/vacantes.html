<!-- src/app/pages/vacantes/vacantes.html -->
<div class="vacantes-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="header-icon">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
        </svg>
      </div>
      <div>
        <h1>Bienvenido, Usuario Empresa</h1>
        <p>Panel de control para gestionar tu proceso de reclutamiento inteligente</p>
      </div>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div *ngFor="let stat of stats()" [class]="'stat-card stat-' + stat.color">
      <h3>{{ stat.title }}</h3>
      <div class="stat-value">{{ stat.value }}</div>
      <div class="stat-change">{{ stat.change }}</div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button
      *ngFor="let tab of tabs"
      [class.active]="activeTab() === tab.id"
      (click)="setActiveTab(tab.id)"
      class="tab-button"
    >
      {{ tab.label }}
    </button>
  </div>

  <!-- Vacantes Section -->
  <div class="section-header">
    <div>
      <h2>Gestión de Vacantes</h2>
      <p>Crea y administra las posiciones abiertas con configuración de IA personalizada</p>
    </div>
    <button class="btn-primary" (click)="openModal(null)">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Nueva Vacante
    </button>
  </div>

  <!-- Vacantes List with Scroll -->
  <div class="vacantes-list">
    <!-- Loading State -->
    <div *ngIf="loading()" class="empty-state">
      <div class="loading-spinner"></div>
      <p class="mt-3">Cargando vacantes...</p>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading() && vacantes().length === 0" class="empty-state">
      <svg
        width="80"
        height="80"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
      >
        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
      </svg>
      <h3>No hay vacantes activas</h3>
      <p>Comienza creando tu primera vacante para atraer candidatos</p>
      <button class="btn-primary" (click)="openModal(null)">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Crear Primera Vacante
      </button>
    </div>

    <!-- Vacantes Cards -->
    <div *ngFor="let vacante of vacantes()" class="vacante-card">
      <div class="vacante-header">
        <div class="vacante-title-section">
          <h3>{{ vacante.puesto }}</h3>
          <span class="badge-active" *ngIf="vacante.activa">Activa</span>
        </div>
        <div class="vacante-actions">
          <button class="btn-icon" title="Ver Detalles">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            Ver Detalles
          </button>
          <button class="btn-icon-only" (click)="openModal(vacante)" title="Editar">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button class="btn-icon-only" (click)="eliminarVacante(vacante.id!)" title="Eliminar">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="3 6 5 6 21 6"></polyline>
              <path
                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
              ></path>
            </svg>
          </button>
        </div>
      </div>

      <div class="vacante-info-grid">
        <div class="info-item">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
          </svg>
          {{ vacante.departamento }}
        </div>
        <div class="info-item">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          {{ vacante.ubicacion }}
        </div>
        <div class="info-item">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
          {{ vacante.salario }}
        </div>
        <div class="info-item">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          {{ vacante.candidatos }} candidatos
        </div>
        <div class="info-item">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          {{ vacante.duracionIA }}
        </div>
      </div>

      <p class="vacante-description">{{ vacante.descripcion }}</p>

      <div class="vacante-footer">
        <span>Publicada: {{ vacante.publicada }}</span>
        <span>Cierra: {{ vacante.cierra }}</span>
        <span>{{ vacante.preguntasIA }} preguntas IA configuradas</span>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal()" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editingVacante() ? 'Editar Vacante' : 'Crear Nueva Vacante' }}</h2>
        <button class="btn-close" (click)="closeModal()">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <p class="modal-subtitle">
          Define la información del puesto y configura la entrevista con IA
        </p>

        <!-- Información del Puesto -->
        <section class="form-section">
          <h3>Información del Puesto</h3>

          <div class="form-grid-2">
            <div class="form-group">
              <label>Título del Puesto</label>
              <input
                type="text"
                [ngModel]="formData().puesto"
                (ngModelChange)="updateFormField('puesto', $event)"
                placeholder="ej. Desarrollador Frontend Senior"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label>Departamento</label>
              <input
                type="text"
                [ngModel]="formData().departamento"
                (ngModelChange)="updateFormField('departamento', $event)"
                placeholder="ej. Tecnología"
                class="form-input"
              />
            </div>
          </div>

          <div class="form-grid-2">
            <div class="form-group">
              <label>Ubicación</label>
              <input
                type="text"
                [ngModel]="formData().ubicacion"
                (ngModelChange)="updateFormField('ubicacion', $event)"
                placeholder="ej. Madrid, España"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label>Tipo de Contrato</label>
              <select
                [ngModel]="formData().tipo_contrato"
                (ngModelChange)="updateFormField('tipo_contrato', $event)"
                class="form-select"
              >
                <option value="Tiempo Completo">Tiempo Completo</option>
                <option value="Medio Tiempo">Medio Tiempo</option>
                <option value="Contrato">Contrato</option>
                <option value="Freelance">Freelance</option>
              </select>
            </div>
          </div>

          <div class="form-grid-2">
            <div class="form-group">
              <label>Salario Mínimo (EUR)</label>
              <input
                type="number"
                [ngModel]="formData().salarioMin"
                (ngModelChange)="updateFormField('salarioMin', $event)"
                placeholder="45000"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label>Salario Máximo (EUR)</label>
              <input
                type="number"
                [ngModel]="formData().salarioMax"
                (ngModelChange)="updateFormField('salarioMax', $event)"
                placeholder="65000"
                class="form-input"
              />
            </div>
          </div>

          <div class="form-group">
            <div class="form-group-header">
              <label>Generar Contenido con IA</label>
              <button class="btn-generate-ia" (click)="generarConIA()">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
                Generar Vacante
              </button>
            </div>
            <p class="form-help">
              Crea automáticamente la descripción, requisitos y preguntas de entrevista basado en el
              título del puesto
            </p>
          </div>
        </section>

        <!-- Descripción del Puesto -->
        <section class="form-section">
          <h3>Descripción del Puesto</h3>

          <div class="form-group">
            <label>Descripción</label>
            <textarea
              [ngModel]="formData().descripcion"
              (ngModelChange)="updateFormField('descripcion', $event)"
              rows="4"
              placeholder="Describe el puesto, la empresa y lo que buscan..."
              class="form-textarea"
            ></textarea>
          </div>

          <div class="form-group">
            <label>Requisitos (uno por línea)</label>
            <div *ngFor="let req of formData().requisitos; let i = index" class="array-input-group">
              <input
                type="text"
                [ngModel]="req"
                (ngModelChange)="updateArrayItem('requisitos', i, $event)"
                placeholder="ej. 5+ años de experiencia en React"
                class="form-input"
              />
              <button
                *ngIf="formData().requisitos.length > 1"
                (click)="removeArrayItem('requisitos', i)"
                class="btn-remove"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <button (click)="addArrayItem('requisitos')" class="btn-add-item">
              + Agregar Requisito
            </button>
          </div>

          <div class="form-group">
            <label>Responsabilidades (una por línea)</label>
            <div
              *ngFor="let resp of formData().responsabilidades; let i = index"
              class="array-input-group"
            >
              <input
                type="text"
                [ngModel]="resp"
                (ngModelChange)="updateArrayItem('responsabilidades', i, $event)"
                placeholder="ej. Desarrollar interfaces de usuario"
                class="form-input"
              />
              <button
                *ngIf="formData().responsabilidades.length > 1"
                (click)="removeArrayItem('responsabilidades', i)"
                class="btn-remove"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            <button (click)="addArrayItem('responsabilidades')" class="btn-add-item">
              + Agregar Responsabilidad
            </button>
          </div>
        </section>

        <!-- Configuración de Entrevista IA -->
        <section class="form-section">
          <h3>Configuración de Entrevista IA</h3>

          <div class="form-grid-2">
            <div class="form-group">
              <label>Duración (minutos)</label>
              <input
                type="number"
                [ngModel]="formData().duracion"
                (ngModelChange)="updateFormField('duracion', $event)"
                class="form-input"
              />
            </div>

            <div class="form-group">
              <label>Puntuación Mínima (%)</label>
              <input
                type="number"
                [ngModel]="formData().puntuacionMinima"
                (ngModelChange)="updateFormField('puntuacionMinima', $event)"
                class="form-input"
              />
            </div>
          </div>

          <div class="form-group">
            <div class="form-group-header">
              <label>Preguntas Personalizadas</label>
              <button class="btn-add-question" (click)="agregarPregunta()">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Agregar Pregunta
              </button>
            </div>

            <div *ngFor="let pregunta of preguntas(); let i = index" class="pregunta-card">
              <div class="pregunta-header">
                <h4>Pregunta {{ i + 1 }}</h4>
                <button
                  *ngIf="preguntas().length > 1"
                  (click)="eliminarPregunta(pregunta.id)"
                  class="btn-icon-only btn-delete"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path
                      d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                    ></path>
                  </svg>
                </button>
              </div>

              <div class="form-group">
                <label>Pregunta</label>
                <textarea
                  [ngModel]="pregunta.pregunta"
                  (ngModelChange)="actualizarPregunta(pregunta.id, 'pregunta', $event)"
                  rows="2"
                  placeholder="Escribe la pregunta de la entrevista..."
                  class="form-textarea"
                ></textarea>
              </div>

              <div class="form-grid-2">
                <div class="form-group">
                  <label>Tipo</label>
                  <select
                    [ngModel]="pregunta.tipo"
                    (ngModelChange)="actualizarPregunta(pregunta.id, 'tipo', $event)"
                    class="form-select"
                  >
                    <option value="Técnica">Técnica</option>
                    <option value="Conductual">Conductual</option>
                    <option value="Situacional">Situacional</option>
                    <option value="Cultural">Cultural</option>
                  </select>
                </div>

                <div class="form-group">
                  <label>Peso (%)</label>
                  <input
                    type="number"
                    [ngModel]="pregunta.peso"
                    (ngModelChange)="actualizarPregunta(pregunta.id, 'peso', $event)"
                    min="0"
                    max="100"
                    class="form-input"
                  />
                </div>
              </div>

              <div class="form-group">
                <label>Palabras Clave Esperadas (separadas por comas)</label>
                <input
                  type="text"
                  [ngModel]="pregunta.palabrasClave"
                  (ngModelChange)="actualizarPregunta(pregunta.id, 'palabrasClave', $event)"
                  placeholder="react, componentes, hooks, estado"
                  class="form-input"
                />
              </div>
            </div>
          </div>
        </section>
      </div>

      <div class="modal-footer">
        <button (click)="closeModal()" class="btn-secondary">Cancelar</button>
        <button (click)="guardarVacante()" class="btn-primary" [disabled]="loading()">
          <span *ngIf="loading()" class="loading-spinner"></span>
          <span *ngIf="!loading()">{{
            editingVacante() ? 'Actualizar Vacante' : 'Crear Vacante'
          }}</span>
        </button>
      </div>
    </div>
  </div>
</div>

